<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Color Picker Example</title>
    <link rel="stylesheet" href="color-picker.css">
  </head>
  <body>

    <div id="color-picker-container">

      <button type="button" class="Button MenuToggle">Theme Color</button>

      <div class="Menu ColorPicker u-hidden" tabindex="-1">
        <div class="dropdown-caret">
          <span class="caret-outer"></span>
          <span class="caret-inner"></span>
        </div>
        <div class="ColorPicker-colorList">
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#fa743e" style="background-color: #fa743e" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#ffcc4d" style="background-color: #ffcc4d" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#94d487" style="background-color: #94d487" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#4a913c" style="background-color: #4a913c" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#89c9fa" style="background-color: #89c9fa" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#3b94d9" style="background-color: #3b94d9" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#abb8c2" style="background-color: #abb8c2" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#dd2e44" style="background-color: #dd2e44" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
          <div class="ColorPicker-transparent">
            <div class="ColorPicker-item ColorPicker-color" data-color="#f5abb5" style="background-color: #f5abb5" tabindex="-1">
              <div class="Icon Icon--smallest"></div>
            </div>
          </div>
        </div>
      </div>

    </div>

  </body>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script>

    (function($) {

      function showDropdown(e) {
        activeEl = document.activeElement;
        $colorPicker.removeClass('u-hidden');
        $colorPicker.focus();
        dropdownOpen = true;
      }

      function closeDropdown(e) {
        var target = e.target;
        var $target = $(target);

        if (!dropdownOpen) {
          return;
        }

        if ($.contains($toggleButton[0], target) || $target.is($toggleButton)) {
          return;
        }

        if ($.contains($colorPicker[0], target) || $target.is($colorPicker)) {
          return;
        }

        $colorPicker.addClass('u-hidden');
        dropdownOpen = false;
      }

      function onEsc(e) {
        if (!dropdownOpen) {
          return;
        }

        if (e.keyCode != 27) {
          return;
        }

        $colorPicker.addClass('u-hidden');
        dropdownOpen = false;
        activeEl.focus();
      }

      function changeColor(e, color) {
        $toggleButton.css('background-color', color);
      }

      function selectColor(e) {
        var enterOrSpace = {
          13: true,
          32: true
        }[e.keyCode];

        if (e.keyCode && !enterOrSpace) {
          return;
        }

        var $color = $(this);

        $colorPicker.find('.Icon--check').removeClass('Icon--check');
        $color.find('.Icon').addClass('Icon--check');

        $(document).trigger('uiUpdateColor', [ $color.data('color') ]);
      }

      function moveSelection(e) {
        var target = e.target;
        var keyCode = e.keyCode;

        if (!dropdownOpen) {
          return;
        }

        var direction = {
          37: 'prev', // Left arrow
          38: 'prev', // Up arrow
          39: 'next', // Right arrow
          40: 'next' // Down arrow
        }[e.keyCode];

        if (!direction) {
          return;
        }

        var $menuitems = $('.ColorPicker-item');
        var $selected = $(document.activeElement);
        var $next;
        var index;

        if ($selected.length) {
          index = $menuitems.index($selected);
          index = (direction == 'next') ? index + 1 : index - 1;
          $next = $menuitems.eq(index);
        }

        if (!$next || $next && !$next.length) {
          $next = (direction == 'next') ? $menuitems.first() : $menuitems.last();
        }

        if ($next.length) {
          $next[0].focus();

          // Prevent scrolling of the window when the user is navigating the
          // menuitems via the arrow keys.
          e.preventDefault();
        }
      }

      var $toggleButton = $('.MenuToggle');
      var $colorPicker = $('.ColorPicker');
      var dropdownOpen = false;
      var activeEl = null;

      $.fn.colorPicker = function () {
        this.on('click', '.MenuToggle', showDropdown);
        this.on('click', '.ColorPicker-color', selectColor);

        this.on('keydown', moveSelection);
        this.on('keydown', '.ColorPicker-color', selectColor);

        $(document).on('keydown', onEsc);
        $(document).on('mousedown', closeDropdown);
        $(document).on('uiUpdateColor', changeColor);
      };

    }(jQuery));

    $('#color-picker-container').colorPicker();

  </script>

<html>
